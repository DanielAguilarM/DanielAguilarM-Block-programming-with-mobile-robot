Blockly.defineBlocksWithJsonArray([
  {
    "type": "Up",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Up.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  }
  ,
  {
    "type": "Down",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Down.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "Left",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Left.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "Right",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Right.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "TopLeft",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/TopLeft.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "TopRight",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/TopRight.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "BackLeft",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/BackLeft.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "BackRight",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/BackRight.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_number",
        "name": "NUM_INPUT",
        "value": 0,  // Valor inicial
        "min": 0,    // Mínimo valor permitido
        "max": 999,  // Máximo valor permitido
        "precision": 1  // Incrementos del valor
      },
      {
        "type": "field_label",
        "text": "cm",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "TurnLeft",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/TurnLeft.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_dropdown",
        "name": "GRADES_DROPDOWN",
        "options": [
          ["90", "90"],
          ["180", "180"],
          ["270", "270"],
          ["360", "360"]        
        ]
      },
      {
        "type": "field_label",
        "text": "grados",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "TurnRight",
    "message0": "%1 %2 %3",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/TurnRight.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_dropdown",
        "name": "GRADES_DROPDOWN",
        "options": [
          ["90", "90"],
          ["180", "180"],
          ["270", "270"],
          ["360", "360"]        
        ]
      },
      {
        "type": "field_label",
        "text": "grados",  // Texto descriptivo que aparecerá a la derecha del número
        "class": "right-side-label"  // Clase opcional para estilización adicional si es necesario
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "Led",
    "message0": "%1 %2",
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Led.png",
        "width": 64,
        "height": 64,
        "alt": "Descripción alternativa"
      },
      {
        "type": "field_dropdown",
        "name": "COLOR_DROPDOWN",
        "options": [
          ["Rojo", "RED"],
          ["Azul", "BLUE"],
          ["Amarillo", "YELLOW"],
          ["Rosa", "PINK"],
          ["Cian", "CYAN"],
          ["Magenta", "MAGENTA"],
          ["Blanco", "WHITE"],
          ["Naranja", "ORANGE"],
          ["Púrpura", "PURPLE"]
        ]
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": "#0afff3",
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  }
  ,
  {
    "type": "Sound",
    "message0": "%1 %2",
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/SoundA.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_input",
        "name": "LETTER_INPUT",
        "text": "A",
        "spellcheck": false
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "Sensor",
    "message0": "%1 %2",  // %1 es para la imagen, %2 para el número, %3 para el texto descriptivo
    "args0": [
      {
        "type": "field_image",
        "src": "Bloques/Sensorr.png",
        "width": 150,
        "height": 60,
        "alt": "Logo"
      },
      {
        "type": "field_dropdown",
        "name": "GRADES_DROPDOWN",
        "options": [
          ["frontal", "F"],
          ["izquierda", "L"],
          ["derecha", "R"]      
        ]
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 150,
    "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
    "helpUrl": ""
  },
  {
    "type": "repeat_block",
    "message0": "Repetir %1 veces",
    "args0": [
      {
        "type": "field_number",
        "name": "NUM_ITERATIONS",
        "value": 10,
        "min": 0,
        "max": 100,
        "precision": 1
      }
    ],
    "message1": "hacer %1",
    "args1": [
      {
        "type": "input_statement",
        "name": "DO"
      }
    ],
    "previousStatement": null,
    "nextStatement": null,
    "colour": 120,
    "tooltip": "Repite los bloques internos un número fijo de veces.",
    "helpUrl": ""
  }
  
  
  ]);
  
Blockly.JavaScript['Down'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'Down_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['Up'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'Up_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['Left'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'Left_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['Right'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'Right_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['TopLeft'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'DFLeft_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['TopRight'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'DFRight_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['BackLeft'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'DBLeft_' + number_input + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['BackRight'] = function(block) {
  // Acceder al valor numérico del campo 'NUM_INPUT'
  var number_input = block.getFieldValue('NUM_INPUT');
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'DBRight_' + number_input + ';\nStop;\n';
  return code;
};
Blockly.JavaScript['TurnLeft'] = function(block) {
  var dropdown_value = block.getFieldValue('GRADES_DROPDOWN');
  var repetitions = 0;
  
  // Determinar cuántas veces se debe repetir la cadena
  switch (dropdown_value) {
    case '90':
      repetitions = 1;
      break;
    case '180':
      repetitions = 2;
      break;
    case '270':
      repetitions = 3;
      break;
    case '360':
      repetitions = 4;
      break;
    default:
      break;
  }
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = '';
  for (var i = 0; i < repetitions; i++) {
    code += 'TLeft_90;\nStop;\n';
  }
  
  return code;
};

Blockly.JavaScript['TurnRight'] = function(block) {
  var dropdown_value = block.getFieldValue('GRADES_DROPDOWN');
  var repetitions = 0;
  
  // Determinar cuántas veces se debe repetir la cadena
  switch (dropdown_value) {
    case '90':
      repetitions = 1;
      break;
    case '180':
      repetitions = 2;
      break;
    case '270':
      repetitions = 3;
      break;
    case '360':
      repetitions = 4;
      break;
    default:
      break;
  }
  
  // Crear la cadena de retorno incorporando el valor numérico
  var code = '';
  for (var i = 0; i < repetitions; i++) {
    code += 'TRight_90;\nStop;\n';
  }
  
  return code;
};


Blockly.JavaScript['Sensor'] = function(block) {
  var dropdown_value = block.getFieldValue('GRADES_DROPDOWN');

  // Crear la cadena de retorno incorporando el valor numérico
  var code = 'Sensor' + dropdown_value + ';\nStop;\n';
  return code;
};
Blockly.Blocks['Led'] = {
  init: function() {
      this.jsonInit({
          "message0": "%1 %2",
          "args0": [
              {
                  "type": "field_image",
                  "src": "Bloques/Led.png",
                  "width": 64,
                  "height": 64,
                  "alt": "Descripción alternativa"
              },
              {
                  "type": "field_dropdown",
                  "name": "COLOR_DROPDOWN",
                  "options": [
                    ["Rojo", "RED"],
                    ["Azul", "BLUE"],
                    ["Amarillo", "YELLOW"],
                    ["Rosa", "PINK"],
                    ["Cian", "CYAN"],
                    ["Magenta", "MAGENTA"],
                    ["Blanco", "WHITE"],
                    ["Naranja", "ORANGE"],
                    ["Púrpura", "PURPLE"]
                  ]
              }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": "#0afff3",
          "tooltip": "Usa este bloque para añadir un logo o imagen y ajustar parámetros.",
          "helpUrl": ""
      });

      // Actualiza el color del bloque basándose en el valor actual del dropdown
      this.getField('COLOR_DROPDOWN').setValidator((newValue) => {
          this.updateBlockColour(newValue);
          return newValue;
      });
  },

  // Función para actualizar el color del bloque
  updateBlockColour: function(color) {
      switch(color) {
          case 'RED':
              this.setColour("#b81414");
              break;
          case 'BLUE':
              this.setColour("#0083ff");
              break;
          case 'YELLOW':
              this.setColour("#FFFF00");
              break;
          case 'PINK':
              this.setColour("#FFC0CB");
              break;
          case 'CYAN':
              this.setColour("#00FFFF");
              break;
          case 'MAGENTA':
              this.setColour("#FF00FF");
              break;
          case 'WHITE':
              this.setColour("#FFFFFF");
              break;
          case 'ORANGE':
              this.setColour("#FFA500");
              break;
          case 'PURPLE':
              this.setColour("#800080");
              break;
          default:
              this.setColour("#0afff3");  // Default color
      }
  }
};


Blockly.JavaScript['Led'] = function(block) {
  var dropdown_value = block.getFieldValue('COLOR_DROPDOWN');
  var code =  dropdown_value + ';\nStop;\n';
  return code;
};

Blockly.JavaScript['repeat_block'] = function(block) {
  var iterations = Number(block.getFieldValue('NUM_ITERATIONS'));
  var statements_do = Blockly.JavaScript.statementToCode(block, 'DO').trim();
  var code = '';

  for (var i = 0; i < iterations; i++) {
      // Agregar el código de las instrucciones y un salto de línea al final de cada una
      code += statements_do.replace(/\n\s+/g, '\n').trim() + '\n';
  }
  return code;  // Devuelve el código con formato adecuado
};


Blockly.Blocks['Sound'] = {
  init: function() {
    this.appendDummyInput()
        .appendField(new Blockly.FieldImage("Bloques/SoundA.png", 150, 60, { alt: "Logo", flipRtl: "FALSE" }))
        .appendField(new Blockly.FieldTextInput("A", function(newValue) {
            // Convierte cualquier entrada a mayúsculas
            var upperCaseValue = newValue.toUpperCase();

            // Verifica que la entrada convertida sea una sola letra de la A a la Z
            if (/^[A-Z]$/.test(upperCaseValue)) {
                return upperCaseValue;  // Devuelve el valor convertido si es válido
            }
            return null;  // No acepta el cambio si no es una letra válida
        }), 'LETTER_INPUT');

    this.setPreviousStatement(true);
    this.setNextStatement(true);
    this.setColour(230);
    this.setTooltip("Usa este bloque para añadir un logo o imagen y ajustar parámetros.");
    this.setHelpUrl("");
  }
};


Blockly.JavaScript['Sound'] = function(block) {
  var letter = block.getFieldValue('LETTER_INPUT');  // Obtiene el valor actual del campo de entrada
  // Genera código que será parte del archivo .txt exportado
  var code = 'Sound' + letter + ';\nStop;\n';  // Agrega una nueva línea para claridad
  return code;
};

